<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heavanora Perfumes - Set 1</title>
    
    <!-- Google Fonts: Lustria (Headings), Roboto (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lustria&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    
    <style>
        :root {
            --primary-color: #B99C6B; /* A muted, elegant gold */
            --dark-bg: #1C1C1C;
            --text-color: #333;
            --light-text: #f5f5f5;
            --section-bg: #f9f8f6;
            --success-color: #2E7D32;
            --heading-font: 'Lustria', serif;
            --body-font: 'Roboto', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--body-font);
            background-color: #fff;
            color: var(--text-color);
            line-height: 1.7;
            overflow-x: hidden;
            /* Fix: ‡¶®‡¶ø‡¶õ‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶¢‡ßá‡¶ï‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® */
            padding-bottom: 120px; 
        }

        h1, h2, h3, p.step-title { font-family: var(--heading-font); }
        button, input, textarea, label { font-family: inherit; }

        /* --- Main Page Styles --- */
        .image-slider-section { position: relative; width: 100%; height: 65vh; overflow: hidden; }
        .slider-wrapper { display: flex; height: 100%; transition: transform 0.7s ease-in-out; }
        .slider-wrapper img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; }
        
        .product-details { padding: 60px 5%; text-align: center; }
        .product-details h1 { font-size: 3rem; margin-bottom: 20px; letter-spacing: 1px; }
        .product-details p { max-width: 700px; margin: 0 auto; line-height: 1.8; color: #555; font-size: 1.05rem; }
        
        .action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.08);
            display: flex; padding: 15px; gap: 15px; z-index: 998;
        }
        .action-btn { flex: 1; padding: 16px; border: none; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; border-radius: 8px; }
        .btn-support { background-color: #f0f0f0; border: 1px solid #ddd; }
        .btn-support:hover { background-color: #e0e0e0; }
        .btn-start-order { background-color: var(--dark-bg); color: #fff; }
        .btn-start-order:hover { background-color: #000; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* --- Full-Screen Order Flow --- */
        .order-flow {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #ffffff; z-index: 1001; display: flex; flex-direction: column;
            transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .order-flow.active { transform: translateY(0); }
        
        .flow-header { padding: 15px 20px; display: flex; align-items: center; border-bottom: 1px solid #eee; flex-shrink: 0; }
        .close-flow { font-size: 1.8rem; cursor: pointer; color: #888; border: none; background: none; margin-right: 15px; line-height: 1; transition: color 0.3s; }
        .close-flow:hover { color: #333; }
        .flow-header h2 { font-size: 1.4rem; font-weight: 400; }
        
        .progress-bar-container { width: 100%; background-color: #f0f0f0; }
        .progress-bar { height: 5px; width: 0%; background: linear-gradient(90deg, #d3b98d, var(--primary-color)); transition: width 0.4s ease; }
        
        .flow-body { flex-grow: 1; overflow-y: auto; padding: 30px 25px; }
        .flow-footer { padding: 20px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; flex-shrink: 0; }
        
        .order-step { display: none; }
        .order-step.active { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .step-title { font-size: 1.8rem; margin-bottom: 30px; }
        
        .fragrance-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .fragrance-item {
            display: flex; align-items: center; background-color: var(--section-bg);
            padding: 15px; border-radius: 8px; cursor: pointer;
            border: 2px solid transparent; transition: all 0.2s; position: relative;
        }
        .fragrance-item:hover { transform: scale(1.03); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .fragrance-item input { opacity: 0; position: absolute; }
        .fragrance-item .checkmark {
            width: 22px; height: 22px; border: 2px solid #ccc;
            border-radius: 50%; margin-right: 15px; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .fragrance-item .checkmark::after { content: '‚úì'; color: #fff; font-size: 14px; opacity: 0; transform: scale(0.5); transition: all 0.2s; }
        .fragrance-item.checked { background-color: #FDF4E3; border-color: var(--primary-color); }
        .fragrance-item.checked .checkmark { background-color: var(--primary-color); border-color: var(--primary-color); }
        .fragrance-item.checked .checkmark::after { opacity: 1; transform: scale(1); }
        .fragrance-item.disabled { opacity: 0.6; cursor: not-allowed; background: #f1f1f1; }
        .fragrance-item.disabled:hover { transform: none; box-shadow: none; }
        .selection-counter { margin-top: 25px; font-weight: 500; color: #555; text-align: center; font-size: 1.1rem; }
        
        .quantity-list .item { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee; }
        .quantity-list .item:last-child { border-bottom: none; }
        .quantity-list .item-name { font-weight: 500; }
        .quantity-selector { display: flex; align-items: center; gap: 15px; }
        .quantity-selector button { width: 38px; height: 38px; border: 1px solid #ccc; background: #fff; cursor: pointer; font-size: 1.6rem; border-radius: 50%; display: grid; place-items: center; line-height: 0; transition: background-color 0.2s; }
        .quantity-selector button:hover { background-color: #f5f5f5; }
        .quantity-selector .qty-input { font-size: 1.2rem; font-weight: 500; width: 30px; text-align: center; border: none; background: transparent; }
        
        .form-group { margin-bottom: 25px; }
        label, .radio-group p { display: block; margin-bottom: 12px; font-weight: 500; }
        input[type="text"], input[type="tel"], textarea { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        input[type="text"]:focus, input[type="tel"]:focus, textarea:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(185, 156, 107, 0.2); }
        .radio-group label { display: block; background-color: var(--section-bg); padding: 18px; border-radius: 8px; margin-bottom: 12px; border: 2px solid transparent; cursor: pointer; transition: all 0.2s ease; }
        .radio-group input[type="radio"] { display: none; }
        .radio-group input[type="radio"]:checked + label { border-color: var(--primary-color); background-color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .nav-btn { padding: 15px 35px; border-radius: 8px; font-size: 1rem; border: none; cursor: pointer; transition: all 0.3s; }
        .nav-btn:disabled { background-color: #ccc !important; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        /* --- Improved Order Summary --- */
        .summary-wrapper { border: 1px solid #eee; border-radius: 8px; }
        .summary-section { padding: 20px; border-bottom: 1px solid #eee; }
        .summary-section:last-child { border-bottom: none; }
        .summary-section h3 { font-family: var(--heading-font); margin-bottom: 15px; font-size: 1.3rem; border-bottom: 1px dashed #ddd; padding-bottom: 10px; }
        .summary-line { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .summary-line span:first-child { color: #666; }
        .summary-item-list li { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.95rem; }
        .summary-total { font-size: 1.5rem; font-weight: 700; text-align: right; margin-top: 20px; display: flex; justify-content: space-between; padding: 20px; background: var(--section-bg); border-radius: 0 0 8px 8px; }

        /* --- Improved Success Step --- */
        .success-container { text-align: center; padding: 50px 20px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .success-icon { width: 100px; height: 100px; background: #E8F5E9; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 30px; animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .success-icon i { color: var(--success-color); font-size: 3rem; }
        .success-container h2 { color: var(--success-color); font-size: 2.5rem; }
        .success-container p { font-size: 1.1rem; max-width: 400px; margin: 15px auto 30px; }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <main>
        <section class="image-slider-section">
            <div class="slider-wrapper" id="mainSlider">
                <img src="1.jpg" alt="Set 1 Image 1">
                <img src="2.jpg" alt="Set 1 Image 2">
                <img src="3.jpg" alt="Set 1 Image 3">
            </div>
        </section>

        <section class="product-details">
            <h1>Havenora Perfumes ‚Äî Set-1 Order (4√ó6ml + 3ml Free)</h1>
            <p>100% Concentrated imported perfume oil ‚Äî 8‚Äì10 hours lasting guarantee
‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø: ‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞ ‡ß≠‡ß¶‡ß≥, ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡ßß‡ß®‡ß¶‡ß≥‡•§ ‡¶è‡¶ï‡¶á ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡ß®‡¶ü‡¶æ ‡¶∏‡ßá‡¶ü ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶®‡¶ø‡¶≤‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶´‡ßç‡¶∞‡¶ø ‚úÖ
Set-1: ‡ß™√ó‡ß¨ml (Spray/Roll-on) + ‡ßß√ó‡ß©ml Roll-on (‡¶´‡ßç‡¶∞‡¶ø) = ‡ß´‡ß´‡ß¶‡ß≥
‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶Ö‡¶™‡¶∂‡¶®: ‡¶´‡ßç‡¶∞‡¶ø ‡ß©ml-‡¶è‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá ‡ß¨ml ‡¶®‡¶ø‡¶≤‡ßá +‡ß´‡ß¶‡ß≥ ‚áí ‡ß¨‡ß¶‡ß¶‡ß≥ (‡¶§‡¶ñ‡¶® ‡ß©ml ‡¶´‡ßç‡¶∞‡¶ø ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶®‡¶æ)
Men/Women/Unisex ‚Äî ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßã‡¶ü ‡ß´‡¶ü‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶®; ‡¶è‡¶∞‡¶™‡¶∞ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶¶‡¶ø‡¶® (Spray 6ml / Roll-on 6ml)
‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶´‡¶æ‡¶∞:
üîπ ‡ß©‡ß¶ml Spray/Roll-on = ‡ß´‡ß´‡ß¶‡ß≥
    *‡¶è‡¶ï‡¶ü‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶®‡¶ø‡¶≤‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶´‡ßç‡¶∞‡¶ø*
üîπ ‡ß´‡ß¶ml Spray = ‡ßÆ‡ß¶‡ß¶‡ß≥ (‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶´‡ßç‡¶∞‡¶ø)</p>
        </section>
    </main>
    
    <div class="action-bar">
        <button class="action-btn btn-support">Support</button>
        <button class="action-btn btn-start-order" id="startOrderBtn">Start Order</button>
    </div>

    <div class="order-flow" id="orderFlow">
        <div class="flow-header">
            <button class="close-flow" id="closeFlowBtn">&times;</button>
            <h2 id="flowTitle">Complete Your Order</h2>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="flow-body" id="flowBody">
            <div class="order-step active" id="step-1">
                <p class="step-title">Step 1: Choose 5 Fragrances</p>
                <div class="fragrance-list" id="fragranceListContainer"></div>
                <p class="selection-counter" id="selectionCounter">0/5 selected</p>
            </div>
            <div class="order-step" id="step-2">
                <p class="step-title">Step 2: Set Quantities</p>
                <div class="quantity-list" id="quantitySelectorContainer"></div>
            </div>
            <div class="order-step" id="step-3">
                <p class="step-title">Step 3: Upgrade Options</p>
                <div class="form-group radio-group">
                    <input type="radio" id="basic_3ml" name="upgrade_option" value="basic" checked><label for="basic_3ml"><strong>Basic (3ml Free)</strong><br><small>Standard 3ml bottle for each fragrance.</small></label>
                    <input type="radio" id="upgrade_6ml" name="upgrade_option" value="upgrade"><label for="upgrade_6ml"><strong>Upgrade to 6ml (+50‡ß≥ each)</strong><br><small>Upgrade all selections to 6ml bottles.</small></label>
                </div>
                <div id="typeSelection_6ml" style="display: none;">
                     <div class="form-group radio-group">
                        <p><strong>Type for 6ml Bottles:</strong></p>
                        <input type="radio" id="all_spray" name="type_6ml" value="all_spray" checked><label for="all_spray">All as Spray</label>
                        <input type="radio" id="all_rollon" name="type_6ml" value="all_rollon"><label for="all_rollon">All as Roll-on</label>
                    </div>
                </div>
            </div>
            <div class="order-step" id="step-4">
                 <p class="step-title">Step 4: Delivery Information</p>
                 <div class="form-group"><label for="customerName">Full Name</label><input type="text" id="customerName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required></div>
                 <div class="form-group"><label for="customerPhone">Mobile Number</label><input type="tel" id="customerPhone" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" required></div>
                 <div class="form-group"><label for="customerAddress">Full Address</label><textarea id="customerAddress" rows="3" placeholder="‡¶¨‡¶æ‡ßú‡¶ø/‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ, ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ, ‡¶•‡¶æ‡¶®‡¶æ, ‡¶ú‡ßá‡¶≤‡¶æ" required></textarea></div>
                 <div class="form-group radio-group">
                     <input type="radio" id="loc_dhaka" name="location" value="dhaka" data-charge="70" checked><label for="loc_dhaka">Inside Dhaka (Charge: 70‡ß≥)</label>
                     <input type="radio" id="loc_outside" name="location" value="outside" data-charge="120"><label for="loc_outside">Outside Dhaka (Charge: 120‡ß≥)</label>
                 </div>
            </div>
            <div class="order-step" id="step-5">
                <p class="step-title">Step 5: Confirm Order</p>
                <div id="orderSummaryContainer"></div>
            </div>
            <div class="order-step" id="step-success">
                <div class="success-container">
                    <div class="success-icon"><i class="fas fa-check"></i></div>
                    <h2>Order Placed!</h2>
                    <p>Thank you. We will contact you shortly for confirmation.</p>
                    <button class="action-btn btn-start-order" id="closeSuccessBtn" style="max-width: 200px;">Close</button>
                </div>
            </div>
        </div>
        <div class="flow-footer" id="flowFooter">
            <button class="nav-btn btn-support" id="backBtn">Back</button>
            <button class="nav-btn btn-start-order" id="nextBtn">Next</button>
        </div>
    </div>

    <script type="module">
        // --- Firebase Config (Module Version) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        
        // TODO: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        const firebaseConfig = {
          apiKey: "AIzaSyAb8YsPMOY53GxiycCL6G0MPZdgWe3nnyY",
          authDomain: "movie-92659.firebaseapp.com",
          databaseURL: "https://movie-92659-default-rtdb.firebaseio.com",
          projectId: "movie-92659",
          storageBucket: "movie-92659.firebasestorage.app",
          messagingSenderId: "1090734362509",
          appId: "1:1090734362509:web:86be5583f6e8fcfdfa77c4",
          measurementId: "G-XF1TEP0DSJ"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // --- Set Specific Configuration ---
        const config = { setName: 'Set 1', basePrice: 550, fragranceLimit: 5, upgradePrice: 50 };
        const fragranceMasterList = ["Ocean blue","havoc silver","bleu de chanel","dunhill icon grey","dunhill desire","cr7","D&G men blue","rassasi hawas ice","212 men","aqua 212","Dior sauvage","Ferrari black","rassasi royal blue","armani stronger with you","srk special","nautica voyage","Versace eros","creed aventus","silver stone","aqua di gio","gucci bloom","gucci guilty","gucci rush","lady million","escada moon Sparkle","paris hilton","bombshell Versace","escada sorbetto rosso","Good girl","tommy girl","escada collection","mad about you","fantasy","spice bomb extreme","vanilla sex","vampire blood","Diptique tamdao","ck-one","ehsas al arabia","ysl y"];
        
        let currentStep = 1;
        const totalSteps = 5;
        let orderData = { fragrances: [], quantities: {}, upgrade: 'basic', type_6ml: 'all_spray', customerInfo: {}, totalCost: 0 };

        const ui = {
            orderFlow: document.getElementById('orderFlow'),
            startOrderBtn: document.getElementById('startOrderBtn'),
            closeFlowBtn: document.getElementById('closeFlowBtn'),
            backBtn: document.getElementById('backBtn'),
            nextBtn: document.getElementById('nextBtn'),
            progressBar: document.getElementById('progressBar'),
            closeSuccessBtn: document.getElementById('closeSuccessBtn'),
            flowFooter: document.getElementById('flowFooter'),
            step4Inputs: [document.getElementById('customerName'), document.getElementById('customerPhone'), document.getElementById('customerAddress')]
        };

        ui.startOrderBtn.addEventListener('click', () => ui.orderFlow.classList.add('active'));
        [ui.closeFlowBtn, ui.closeSuccessBtn].forEach(btn => btn.addEventListener('click', () => ui.orderFlow.classList.remove('active')));
        ui.backBtn.addEventListener('click', handleBack);
        ui.nextBtn.addEventListener('click', handleNext);
        
        // Fix: Step 4 ‡¶è‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶®‡¶æ‡¶¨‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§
        ui.step4Inputs.forEach(input => input.addEventListener('input', () => {
            if (currentStep === 4) validateStep(4);
        }));

        function handleBack() { if (currentStep > 1) { currentStep--; updateFlowView(); } }
        function handleNext() {
            if (!validateStep(currentStep)) return;
            saveStepData(currentStep);
            if (currentStep < totalSteps) { currentStep++; updateFlowView(); } 
            else if (currentStep === totalSteps) { placeOrder(); }
        }

        function updateFlowView() {
            document.querySelectorAll('.order-step').forEach(step => step.classList.remove('active'));
            document.getElementById(`step-${currentStep}`).classList.add('active');
            ui.progressBar.style.width = `${((currentStep - 1) / totalSteps) * 100}%`;
            ui.backBtn.style.visibility = currentStep > 1 ? 'visible' : 'hidden';
            ui.nextBtn.textContent = currentStep === totalSteps ? 'Place Order' : 'Next';
            
            if (currentStep === 2) generateQuantitySelectors();
            if (currentStep === 5) generateOrderSummary();

            validateStep(currentStep);
        }
        
        function validateStep(step) {
            let isValid = false;
            if (step === 1) isValid = orderData.fragrances.length === config.fragranceLimit;
            else if (step === 4) isValid = ui.step4Inputs.every(input => input.value.trim() !== '');
            else isValid = true;
            ui.nextBtn.disabled = !isValid;
            return isValid;
        }

        function saveStepData(step) {
            if (step === 3) {
                orderData.upgrade = document.querySelector('input[name="upgrade_option"]:checked').value;
                if (orderData.upgrade === 'upgrade') orderData.type_6ml = document.querySelector('input[name="type_6ml"]:checked').value;
            } else if (step === 4) {
                orderData.customerInfo = { name: document.getElementById('customerName').value, phone: document.getElementById('customerPhone').value, address: document.getElementById('customerAddress').value, location: document.querySelector('input[name="location"]:checked').value };
            }
        }
        
        function initFragranceList() {
            const container = document.getElementById('fragranceListContainer');
            container.innerHTML = fragranceMasterList.map(name => `<label class="fragrance-item"><input type="checkbox"><span class="checkmark"></span><span>${name}</span></label>`).join('');
            const allItems = container.querySelectorAll('.fragrance-item');
            allItems.forEach((item, index) => {
                item.addEventListener('click', e => {
                    e.preventDefault();
                    const name = fragranceMasterList[index];
                    if (item.classList.contains('disabled') && !item.classList.contains('checked')) return;

                    const isChecked = orderData.fragrances.includes(name);
                    if (isChecked) {
                        orderData.fragrances = orderData.fragrances.filter(f => f !== name);
                        item.classList.remove('checked');
                    } else if (orderData.fragrances.length < config.fragranceLimit) {
                        orderData.fragrances.push(name);
                        item.classList.add('checked');
                    }

                    allItems.forEach(el => el.classList.toggle('disabled', orderData.fragrances.length >= config.fragranceLimit && !el.classList.contains('checked')));
                    document.getElementById('selectionCounter').textContent = `${orderData.fragrances.length}/${config.fragranceLimit} selected`;
                    validateStep(1);
                });
            });
        }

        function generateQuantitySelectors() {
            const container = document.getElementById('quantitySelectorContainer');
            container.innerHTML = orderData.fragrances.map(name => {
                orderData.quantities[name] = orderData.quantities[name] || 1;
                return `<div class="item"><span class="item-name">${name}</span><div class="quantity-selector"><button data-name="${name}" data-change="-1">-</button><span class="qty-input">${orderData.quantities[name]}</span><button data-name="${name}" data-change="1">+</button></div></div>`;
            }).join('');

            container.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const name = btn.dataset.name;
                    const change = parseInt(btn.dataset.change);
                    if (orderData.quantities[name] + change >= 1) {
                        orderData.quantities[name] += change;
                        btn.parentElement.querySelector('.qty-input').textContent = orderData.quantities[name];
                    }
                });
            });
        }
        
        document.querySelectorAll('input[name="upgrade_option"]').forEach(radio => radio.addEventListener('change', e => document.getElementById('typeSelection_6ml').style.display = e.target.value === 'upgrade' ? 'block' : 'none'));

        // Fix: ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø ‡¶Ü‡¶∞‡¶ì ‡¶§‡¶•‡ßç‡¶Ø‡¶¨‡¶π‡ßÅ‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
        function generateOrderSummary() {
            const totalItems = Object.values(orderData.quantities).reduce((sum, qty) => sum + qty, 0);
            const upgradeCost = orderData.upgrade === 'upgrade' ? totalItems * config.upgradePrice : 0;
            const deliveryCharge = parseInt(document.querySelector('input[name="location"]:checked').dataset.charge);
            orderData.totalCost = config.basePrice + upgradeCost + deliveryCharge;
            
            const itemsHTML = Object.entries(orderData.quantities).map(([name, qty]) => {
                const size = orderData.upgrade === 'upgrade' ? '6ml' : '3ml';
                const type = orderData.upgrade === 'upgrade' ? `(${orderData.type_6ml.replace('_', ' ').replace('all as ', '')})` : '';
                return `<li><span>${name}</span> <strong>${qty} x ${size} ${type}</strong></li>`;
            }).join('');

            document.getElementById('orderSummaryContainer').innerHTML = `
                <div class="summary-wrapper">
                    <div class="summary-section">
                        <h3>Customer Details</h3>
                        <div class="summary-line"><span>Name:</span> <strong>${orderData.customerInfo.name}</strong></div>
                        <div class="summary-line"><span>Phone:</span> <strong>${orderData.customerInfo.phone}</strong></div>
                        <div class="summary-line"><span>Address:</span> <strong>${orderData.customerInfo.address}</strong></div>
                    </div>
                    <div class="summary-section">
                        <h3>Order Items</h3>
                        <ul class="summary-item-list" style="list-style: none; padding: 0;">${itemsHTML}</ul>
                    </div>
                     <div class="summary-section">
                        <h3>Cost Breakdown</h3>
                        <div class="summary-line"><span>Set Price:</span> <span>${config.basePrice}‡ß≥</span></div>
                        ${upgradeCost > 0 ? `<div class="summary-line"><span>Upgrade to 6ml:</span> <span>${upgradeCost}‡ß≥</span></div>` : ''}
                        <div class="summary-line"><span>Delivery Charge:</span> <span>${deliveryCharge}‡ß≥</span></div>
                    </div>
                    <div class="summary-total">
                        <span>Total Payable:</span>
                        <span>${orderData.totalCost}‡ß≥</span>
                    </div>
                </div>`;
        }


        async function placeOrder() {
            ui.nextBtn.disabled = true; ui.nextBtn.textContent = 'Placing...';
            const orderPayload = { setName: config.setName, ...orderData, timestamp: new Date().toISOString(), status: 'Pending' };
            try {
                await set(push(ref(database, 'orders')), orderPayload);
                currentStep = 'success';
                document.querySelectorAll('.order-step').forEach(step => step.classList.remove('active'));
                document.getElementById(`step-success`).classList.add('active');
                ui.flowFooter.style.display = 'none';
                ui.progressBar.style.width = '100%';
            } catch (error) {
                console.error("Error:", error); alert('Failed to place order.');
                ui.nextBtn.disabled = false; ui.nextBtn.textContent = 'Place Order';
            }
        }
        
        let mainSliderIndex = 0;
        setInterval(() => { mainSliderIndex = (mainSliderIndex + 1) % 3; document.getElementById('mainSlider').style.transform = `translateX(-${mainSliderIndex * 100}%)`; }, 4000);
        
        initFragranceList();
        updateFlowView();
    </script>
</body>
</html>